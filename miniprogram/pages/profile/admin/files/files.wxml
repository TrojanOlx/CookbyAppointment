<!-- æ–‡ä»¶ç®¡ç†é¡µé¢ -->
<view class="container">
  <view class="page-header">
    <text class="page-title">æ–‡ä»¶ç®¡ç†</text>
  </view>
  
  <!-- æ–‡ä»¶å¤¹é€‰æ‹©å™¨ -->
  <view class="folder-selector">
    <view class="section-title">é€‰æ‹©æ–‡ä»¶å¤¹</view>
    <scroll-view scroll-x class="folder-list">
      <view 
        wx:for="{{folders}}" 
        wx:key="*this" 
        bindtap="changeFolder" 
        data-folder="{{item}}"
        class="folder-item {{currentFolder === item ? 'active' : ''}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button bindtap="uploadFile" type="primary" size="mini" class="action-btn">ä¸Šä¼ æ–‡ä»¶</button>
    <button bindtap="uploadImage" type="primary" size="mini" class="action-btn">ä¸Šä¼ å›¾ç‰‡</button>
    <button bindtap="toggleSelectAll" type="default" size="mini" class="action-btn">
      {{selectedFiles.length === files.length && files.length > 0 ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
    </button>
    <button bindtap="batchDelete" type="warn" size="mini" disabled="{{selectedFiles.length === 0}}" class="action-btn">
      æ‰¹é‡åˆ é™¤
    </button>
  </view>
  
  <!-- æ–‡ä»¶åˆ—è¡¨ -->
  <view class="file-list">
    <view class="section-title">æ–‡ä»¶åˆ—è¡¨ ({{files.length}}ä¸ª)</view>
    
    <view wx:if="{{isLoading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:elif="{{files.length === 0}}" class="empty-list">
      <text>æš‚æ— æ–‡ä»¶</text>
    </view>
    
    <view wx:else class="files-grid">
      <view 
        wx:for="{{files}}" 
        wx:key="filePath" 
        class="file-item {{isSelected(item.filePath) ? 'selected' : ''}}"
        bindtap="selectFile"
        data-path="{{item.filePath}}"
      >
        <!-- æ–‡ä»¶å›¾æ ‡ -->
        <view class="file-icon">
          <image 
            referrerPolicy="no-referrer"
            wx:if="{{isImage(item.fileType, item.fileName)}}" 
            src="{{item.url}}" 
            mode="aspectFill" 
            class="file-thumbnail"
            catch:tap="previewImage"
            data-url="{{item.url}}"
          />
          <view wx:else class="file-type-icon">
            <text>{{getFileIcon(item.fileType, item.fileName)}}</text>
          </view>
        </view>
        
        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <view class="file-info">
          <view class="file-name ellipsis">{{item.fileName}}</view>
          <view class="file-meta">
            <text class="file-size">{{formatFileSize(item.fileSize)}}</text>
            <text class="file-date">{{formatDate(item.uploadTime)}}</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="file-actions">
          <view 
            class="action-icon" 
            catch:tap="downloadFile" 
            data-path="{{item.filePath}}"
            data-name="{{item.fileName}}"
          >â¬‡ï¸</view>
          <view 
            class="action-icon" 
            catch:tap="getFileInfo" 
            data-path="{{item.filePath}}"
          >â„¹ï¸</view>
          <view 
            class="action-icon delete" 
            catch:tap="deleteFile" 
            data-path="{{item.filePath}}"
          >ğŸ—‘ï¸</view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ–‡ä»¶ä¿¡æ¯å¼¹çª— -->
  <view class="file-info-modal" wx:if="{{showFileInfo}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ–‡ä»¶è¯¦æƒ…</text>
        <text class="modal-close" bindtap="closeFileInfo">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="info-item">
          <text class="info-label">æ–‡ä»¶å:</text>
          <text class="info-value">{{fileInfoData.fileName}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">è·¯å¾„:</text>
          <text class="info-value">{{fileInfoData.filePath}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç±»å‹:</text>
          <text class="info-value">{{fileInfoData.fileType}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å¤§å°:</text>
          <text class="info-value">{{formatFileSize(fileInfoData.fileSize)}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ä¸Šä¼ æ—¶é—´:</text>
          <text class="info-value">{{formatDate(fileInfoData.uploadTime)}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">URL:</text>
          <text class="info-value info-url" bindtap="copyToClipboard" data-text="{{fileInfoData.url}}">
            {{fileInfoData.url}}
          </text>
        </view>
      </view>
    </view>
  </view>
</view> 